import "@fortawesome/fontawesome-free/css/all.min.css";
import { CodeSurfer, CodeSurferColumns, Step } from "code-surfer";
import t, { codeSurferTheme } from "./theme";
import { ArrowRight } from "./ArrowRight";
import { Centered } from "./Centered";
import { Chart } from "./Chart";
import { Col } from "./Col";
import { Container } from "./Container";
import { FullScreenImg } from "./FullScreenImg";
import { Img } from "./Img";
import { ProgressBar } from "./ProgressBar";
import { RoundedBox } from "./RoundedBox";
import { StepChart } from "./StepChart";
import { Thankyou } from "./Thankyou";
import { TitlePage } from "./TitlePage";
import { TwoCols } from "./TwoCols";
import { WhoAmI } from "./WhoAmI";
import elephant from "./assets/elephant.jpg";
import pingu from "./assets/pingu.jpg";
import ts2365 from "./assets/ts2365.png";
import "./styles.css";

export const theme = t;

<Head>
  <title>React Native for Android Devs</title>
</Head>

<Footer>

<ProgressBar />

</Footer>

<TitlePage />

---

<WhoAmI>

# Who am I

Michele Bonazza

<Steps>

- FullStack Dev at URBI.co
- Co-founder at SketchTogether.com
- Slacker at dist0rtion.com (that's a zero)
- Backend Dev turned FullStack
- 95.90.225.243

</Steps>

</WhoAmI>

<Notes>

Our main app is a mobility aggregator (car/scooter/bike sharing, but also public transport, taxis, and recently trains)

We recently rebuilt our main app from scratch in RN, it's in prod (on Android, soon on iOS)

:heart: for python (although TS is a close second), but lately have been working with Java, Kotlin on the BE, RN and React on the client

I do know Android, I wrote a couple of bigger apps, and a few more toy apps. But I'm not an Android Developer.

</Notes>

---

<Container>

# Who are you

<Steps>

Maybe an Android Developer

Maybe someone who knows about Android Development

Definitely someone who wants to know about React Native

</Steps>

</Container>

---

<Container>

# Why

<Steps>

- Most (or the loudest) RN devs come from React/JS
- Native side seen as last resort (it isn't!)
- RN (and React) are very unopinionated
- Boy, do I have opinions

</Steps>

</Container>

<Notes>

RN stands for React Native

</Notes>

---

<Container>

# What

<TwoCols>
  
<Col>

1. Intro to React Native

2. Brief intro to React

3. A bit more about React Native

4. Q&amp;A

</Col>

<Col>

5. Typescript

6. RN Libraries and frameworks

7. React Native gotchas

8. React Native pros &amp; cons

</Col>

</TwoCols>

</Container>

<Notes>

Intros to RN and React are really brief, I want to focus on real-life development

Most intros have you setup a regular project, so let's skip that

</Notes>

---

<Container>

# React Native

<Steps>

- A framework to build <u>native</u> apps in React

- Android and iOS, but also web, TVs, Windows, and OSX ( <Img src={pingu} height={50} inline /> )

- Learn once, write everywhere

- Write once, wait for Gradle and Xcode to build forever 😬

- Declarative (vs Imperative)

</Steps>

</Container>

<Notes>

Linux => react-native-desktop-qt, but no big company behind it

:stuck_out_tongue: it does take a long time to build from scratch, but you don't do it that often

Declarative meaning that not only the components are specified declaratively (XML), but business logic, too.

</Notes>

---

<FullScreenImg src={elephant} attribution="Victor Zastolskiy" modified />

<Notes>

It's the GDG, of course everyone knows about Flutter

</Notes>

---

<Container>

# Flutter (and Xamarin, and Kotlin Native, and...)

<Steps>

Other cross-platform frameworks exist, each with their own merits

It _really_ depends on your team (do you know Dart? How big is your team? Will you have to hire? Can you easily hire React Devs?)

Fighting over frameworks is **fun** :tada: (you go ahead, though)

More on this later

</Steps>

</Container>

<Notes>

Cordova, ionic framework, NativeScript

</Notes>

---

<Container>

# How does it work

<StepChart>

<RoundedBox>
  
<p>React<br />(JS)</p>

</RoundedBox>

<ArrowRight>JSON</ArrowRight>

<RoundedBox borderGradient={{ left: "#61dafb", right: "#43db86" }}>
  Bridge
</RoundedBox>

<ArrowRight color="#43db86">????</ArrowRight>

<RoundedBox borderColor="#43db86">Native Views</RoundedBox>

</StepChart>

</Container>

---

<Container>

# React

Note:

<Steps>

- If your team is large enough, _you might not need to learn it_ :shushing_face:

- If it's _very_ large, you might be better off without RN, though :thinking_face:

- It's good to know anyway!

</Steps>

</Container>

<Notes>

For solos, of course you need to know everything.

For small teams, it depends: a few native devs who know about bridging + React devs orchestrating?

For large teams, see AirBnB (but also, brownfield apps)

</Notes>

---

<CodeSurfer theme={codeSurferTheme}>

<!-- prettier-ignore-start -->
```jsx title="React" subtitle="* not displayed here: 250MB of node_modules"
import React from "react";

export const HelloSomeone = (props) => (
  <div>
    Hello, {props.who}!
  </div>
);
```

```jsx title="React"
import React from "react";
import { HelloSomeone } from "./HelloSomeone";

export const MyApp = () => (
  <HelloSomeone who="world" />
);
```
<!-- prettier-ignore-end -->

</CodeSurfer>

---

<Container>

# What is React anyway

<StepChart>

<RoundedBox>
  
JSX

</RoundedBox>

<ArrowRight>JS</ArrowRight>

<RoundedBox>Layout tree</RoundedBox>

<ArrowRight>????</ArrowRight>

<RoundedBox>Rendering target</RoundedBox>

</StepChart>

A diff engine for trees :deciduous_tree:

</Container>

<Notes>

You don't need to know any of this while developing a regular RN app!

???? => calls that depend on the actual platform

</Notes>

---

<CodeSurferColumns themes={[codeSurferTheme, codeSurferTheme]}>

<Step>

<!-- prettier-ignore-start -->
```jsx title="React (JS)"
import React from "react";


export const HelloSomeone = (props) => (
  <div>
    Hello, {props.who}!
  </div>
);
```

```jsx title="React Native"
import React from "react";
import { Text, View } from "react-native";

export const HelloSomeone = (props) => (
  <View>
    <Text>Hello, {props.who}!</Text>
  </View>
);
```
<!-- prettier-ignore-end -->

</Step>

<Step>

<!-- prettier-ignore-start -->
```jsx 5,7 title="React (JS)"
import React from "react";


export const HelloSomeone = (props) => (
  <div>
    Hello, {props.who}!
  </div>
);
```

```jsx 2,5,6[5:10,30:36],7 title="React Native"
import React from "react";
import { Text, View } from "react-native";

export const HelloSomeone = (props) => (
  <View>
    <Text>Hello, {props.who}!</Text>
  </View>
);
```
<!-- prettier-ignore-end -->

</Step>

</CodeSurferColumns>

---

<Container>

# React (in browsers)

<Chart>

<RoundedBox>
  
JSX

</RoundedBox>

<ArrowRight>JS</ArrowRight>

<RoundedBox>Virtual DOM</RoundedBox>

<ArrowRight>JS</ArrowRight>

<RoundedBox>DOM</RoundedBox>

</Chart>

</Container>

---

<Container>

# React Native

<Chart>

<RoundedBox>
  
JSX

</RoundedBox>

<ArrowRight>Bridge</ArrowRight>

<RoundedBox borderColor="#43db86">Shadow tree</RoundedBox>

<ArrowRight color="#43db86">Yoga</ArrowRight>

<RoundedBox borderColor="#43db86">Native Views</RoundedBox>

</Chart>

</Container>

<Notes>

The bridge is the same we've seen on the previous slides

Yoga is a cross-platform layout engine written in C that implements FlexBox

</Notes>

---

<Container>

# Under the hood:

<Centered>

:eyes:

</Centered>

</Container>

<Notes>

Hermes, Metro Bundler, Debug, API, Hooks vs setState()

</Notes>

---

<Container>

# More on this

<Centered fontSize="84px">

<a
  href="https://www.youtube.com/watch?v=8va9prUqjnA"
  target="_blank"
  rel="noreferrer"
>
  Emil Sjölander - React Native, The Native Bits
</a>

</Centered>

</Container>

---

<Container>

# Questions?

<Centered fontSize="64px">

Back to StreamYard: https://streamyard.com/jpr2xr6gve

</Centered>

</Container>

---

<Container>

# Typescript

<Steps>

- A _typed_ superset of JS that compiles to JS

- You can have JS coexist with TS: types are _optional_

- Being an Android Dev, you know they really shouldn't be :face_with_monocle:

- It's very smart!

</Steps>

</Container>

<Notes>

Using TS is not needed, but it **will** make your life easier

Use strict is life

Combined with ES6, it reminds me of what Kotlin is to Java

</Notes>

---

<!-- prettier-ignore-start -->

<CodeSurfer theme={codeSurferTheme}>

```ts title="Structural typing"
interface Person {
  name: string;
}

interface Animal {
  name: string;
}
```

```ts 9,10 title="Structural typing"
interface Person {
  name: string;
}

interface Animal {
  name: string;
}

let me: Person = { name: "Michele", speak: () => 'hi!' };
const horseman: Animal = { name: "Bojack" };
```

```diff 1:3,9[37:55]
```

```ts 9:12 title="Structural typing"
interface Person {
  name: string;
}

interface Animal {
  name: string;
}

let me: Person = { name: "Michele", speak: () => 'hi!' };
const horseman: Animal = { name: "Bojack" };

me = horseman; // 👍
```

```ts 1:8 title="Structural typing"
interface Person {
  name: string;
  speak: () => string;
}

interface Animal {
  name: string;
}

let me: Person = { name: "Michele", speak: () => 'hi!' };
const horseman: Animal = { name: "Bojack" };
```

```ts 10:13 title="Structural typing"
interface Person {
  name: string;
  speak: () => string;
}

interface Animal {
  name: string;
}

let me: Person = { name: "Michele", speak: () => 'hi!' };
const horseman: Animal = { name: "Bojack" };

me = horseman; // 👎
```

</CodeSurfer>

<!-- prettier-ignore-end -->

<Notes>

I'm not gonna teach you TS now, just a brief overview at what's in there for you that's not in other typed languages.

</Notes>

---

<!-- prettier-ignore-start -->

<CodeSurfer theme={codeSurferTheme}>

```ts title="Union Types"
interface Product {
  id: string | number;
  status: 'new' | 'ordered' | 'dispatched' | 'delivered';
}

const p: Product = { id: 'ED-209', status: 'new' };
```

```ts 2,7 title="Union Types"
interface Product {
  id: string | number;
  status: 'new' | 'ordered' | 'dispatched' | 'delivered';
}

const p: Product = { id: 'ED-209', status: 'new' };
p.id.length; // 👎
```

```diff 6[8:16]
```

```ts title="Union Types"
interface Product {
  id: string | number;
  status: 'new' | 'ordered' | 'dispatched' | 'delivered';
}

const p: Product = { id: 'ED-209', status: 'new' };
p.id.length; // 👎
console.log(p.id + '3'); // 👍 => 'ED-2093'
```

```ts 8:9 title="Union Types"
interface Product {
  id: string | number;
  status: 'new' | 'ordered' | 'dispatched' | 'delivered';
}

const p: Product = { id: 'ED-209', status: 'new' };
p.id.length; // 👎
console.log(p.id + '3'); // 👍 => 'ED-2093'
console.log(p.id + 3); // 👎 
```

</CodeSurfer>

<!-- prettier-ignore-end -->

---

<Container>

<div
  style={{
    width: "100%",
    height: 0,
    paddingBottom: "54%",
    position: "relative",
  }}
>
  <iframe
    src="https://giphy.com/embed/s239QJIh56sRW"
    width="100%"
    height="100%"
    style={{ position: "absolute" }}
    frameBorder="0"
    class="giphy-embed"
    allowFullScreen
  ></iframe>
</div>

</Container>

---

<Container>

# Strict types

<Steps>

<img src={ts2365} />

`p.id` is defined as `string | number`

```js
'1' + '2' => '12'
```

```js
1 + 2 => 3
```

</Steps>

</Container>

---

<!-- prettier-ignore-start -->

<CodeSurfer theme={codeSurferTheme}>

```ts title="Intersection types"
type PrintSum = (first: number, second: number) => void;

type PrintConcat = (first: string, second: string) => void;
```

```ts 1:6 title="Intersection types"
type PrintSum = (first: number, second: number) => void;

type PrintConcat = (first: string, second: string) => void;

const printPlus: PrintSum & PrintConcat =
  (first: number | string, second: number | string) => null;
```

```diff 5[18:39]
```

```diff 6[11:26,36:50]
```

```diff 1[25:30,41:46],3[28:33,44:49],6[11:26,36:50]
```

```ts 1:8 title="Intersection types"
type PrintSum = (first: number, second: number) => void;

type PrintConcat = (first: string, second: string) => void;

const printPlus: PrintSum & PrintConcat =
  (first: number | string, second: number | string) => null;

printPlus(1, 2); // 👍
```

```ts 1:9 title="Intersection types"
type PrintSum = (first: number, second: number) => void;

type PrintConcat = (first: string, second: string) => void;

const printPlus: PrintSum & PrintConcat =
  (first: number | string, second: number | string) => null;

printPlus(1, 2); // 👍
printPlus('a', 'b'); // 👍
```

```ts 1:10 title="Intersection types"
type PrintSum = (first: number, second: number) => void;

type PrintConcat = (first: string, second: string) => void;

const printPlus: PrintSum & PrintConcat =
  (first: number | string, second: number | string) => null;

printPlus(1, 2); // 👍
printPlus('a', 'b'); // 👍
printPlus(1, 'a'); // 👎
```

</CodeSurfer>

<!-- prettier-ignore-end -->

---

<!-- prettier-ignore-start -->

<CodeSurfer theme={codeSurferTheme}>

```ts title="Tuples"
type Product = [string, number, boolean];
```

```ts 1:3 title="Tuples"
type Product = [string, number, boolean];

const product: Product = ['ED-209', 42, true];
```

```ts 1:5 title="Tuples"
type Product = [string, number, boolean];

const product: Product = ['ED-209', 42, true];

const [id, progressiveId, delivered] = product;
```

```ts 1:9 title="Tuples"
type Product = [string, number, boolean];

const product: Product = ['ED-209', 42, true];

const [id, progressiveId, delivered] = product;

// id is a string
// progressiveId is a number
// delivered is a boolean
```
</CodeSurfer>

<!-- prettier-ignore-end -->

---

<Container>

# More on this

<Centered fontSize="84px">

<a
  href="https://www.youtube.com/watch?v=wD5WGkOEJRs"
  target="_blank"
  rel="noreferrer"
>
  Busy TypeScript Developer’s Guide to Advanced TypeScript | Ted Neward
</a>

</Centered>

</Container>

---

<Container>

# RN Libs and Frameworks

<Steps>

- Navigation :sweat_smile: (<a href="https://reactnavigation.org/" target="_blank" rel="noreferrer">react-navigation</a> vs <a href="https://github.com/wix/react-native-navigation" target="_blank" rel="noreferrer">react-native-navigation</a>)

- Animations (<a href="https://github.com/software-mansion/react-native-reanimated" target="_blank" rel="noreferrer">react-native-reanimated</a>) and Gestures (<a href="https://github.com/software-mansion/react-native-gesture-handler" target="_blank" rel="noreferrer">react-native-gesture-handler</a>) => don't miss <a href="https://www.youtube.com/c/wcandillon/playlists" target="_blank" rel="noreferrer">Can it be done in React Native?</a>!

- Firebase (<a href="https://rnfirebase.io/" target="_blank" rel="noreferrer">react-native-firebase</a>) and Maps (<a href="https://github.com/react-native-community/react-native-maps" target="_blank" rel="noreferrer">react-native-maps</a>)

- Live updates (<a href="https://github.com/microsoft/react-native-code-push" target="_blank" rel="noreferrer">Code Push</a>)

- RN utils (<a href="https://github.com/hectahertz/react-native-typography" target="_blank" rel="noreferrer">react-native-typography</a>, <a href="https://github.com/oblador/react-native-vector-icons" target="_blank" rel="noreferrer">react-native-vector-icons</a>, <a href="https://github.com/react-native-community/react-native-svg" target="_blank" rel="noreferrer">react-native-svg</a>) and JS utils (<a href="https://github.com/fnando/i18n-js" target="_blank" rel="noreferrer">i18n-js</a>, <a href="https://github.com/date-fns/date-fns" target="_blank" rel="noreferrer">date-fns</a>, <a href="https://github.com/lodash/lodash" target="_blank" rel="noreferrer">lodash</a>, <a href="https://github.com/adamwdraper/Numeral-js" target="_blank" rel="noreferrer">numeral</a>, ...)

</Steps>

</Container>

---

<Container>

# Life of a RN developer

<Steps>

- Building for RN inevitably means using many 3rd party libs

- Quality and maintainers responsiveness vary **a lot**

- Things break and you have to wait just to get your PRs approved!

- ...or _do you?_ :smirk:

</Steps>

</Container>

---

<Container>

# The hero npm doesn't deserve

<Steps>

Enter <a href="https://github.com/ds300/patch-package" target="_blank" rel="noreferrer">patch-package</a> :rocket:

Fix the bug directly inside the library's `node_modules` folder

Run `npx patch-packge the-library-you-fixed`

Now you have a `.patch` file that you can commit, and even share! :exploding_head:

</Steps>

</Container>

<Notes>

This is such a huge improvement over any other experience I've had (including gradle) that I wanted to discuss it separately

</Notes>

---

<Container>

# A few RN Gotchas

<Steps>

- Always double-check that there's only **one** running Metro Bundler

- Emulator not connecting => `adb reverse tcp:8081 tcp:8081`

- Circular dependencies do exist (declaration order does matter!)

- Changes to the native side require a full app re-launch

- `yarn install` after checkout, `pod install` if on iOS

</Steps>

</Container>

<Notes>

As said, there's a lot of info not being captured on the official website

This is meant to be a very brief collection of the issues you're most likely to encounter

The goal is to help you think "hey, I've heard about this"

</Notes>

---

<Container>

# A few more RN Gotchas

<Steps>

- Check your 3rd party dependencies quite thoroughly

- If you feel like a task is quickly done natively, go for it!

- Use `React.memo()` and `PureComponent`

- Keep an eye on the bridge :eyes:

- Sometimes a `flexDirection: 'row'` goes a long way

</Steps>

</Container>

<Notes>

You don't need to do an audit, but do check how often the repo is updated, when it was last updated, how many open/closed PRs, whether issues get ignored

</Notes>

---

<Container>

# Final considerations

<Steps>

:+1: Knowing Android makes you special in the RN world :unicorn_face:

:+1: RN actually gives you a chance to reuse your knowledge

:-1: If you're new to React and TS, there is quite a lot to learn

:shrug: ...but then again, you might not need it!

:-1: A smaller core library means you'll have to shop often on GitHub

</Steps>

</Container>

<Notes>

Ironically, with Flutter you're more in the hands of Google: do you know Skia development?

</Notes>

---

<Container>

# Final considerations v2

<Steps>

:+1: You can create apps for iOS without touching Objective-C or Swift

:+1: Hot-reload works out of the box

:+1: Many dev tools borrowed from React

:-1: It takes a while to get familiar with the dev process

:-1: 3rd parties can change their APIs for no reason

</Steps>

</Container>

---

<Container>

# Final considerations v2-final

<Steps>

:+1: If you know FlexBox, you know how to do layouts in RN

:-1: ...but there are a few weird corner cases

:+1: The tech is quite young, but it's been constantly improving

:-1: New native tech will always take some time to be added

:+1: ...but 3rd parties will race to get them done first

</Steps>

</Container>

---

<Thankyou />

---

<Container>

# Questions?

<Centered fontSize="64px">

Back to StreamYard: https://streamyard.com/jpr2xr6gve

</Centered>

</Container>
